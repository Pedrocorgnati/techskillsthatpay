# I18N Architecture

- Supported locales: `en`, `pt`, `es`, `it` (`lib/i18n.ts`). `defaultLocale = en`.
- Domain routing (`lib/domainRouting.ts`):
  - en → `techskillsthatpay.com`
  - pt → `techskillsthatpay.com.br`
  - es → `techskillsthatpay.es`
  - it → `techskillsthatpay.it`
  - Override with `DOMAIN_*` / `NEXT_PUBLIC_DOMAIN_*`.
- URL structure:
  - Production domains use clean paths (no locale prefix).
  - Internal routes remain under `app/[lang]/...` and are reached via middleware rewrite.
- Middleware (`middleware.ts`):
  - If host is a mapped domain: rewrite `/{path}` → `/{locale}/{path}`.
  - If path already has a locale prefix, redirect to clean URL (301).
  - If host is localhost/unknown: keep path-based locale behavior with cookie/Accept-Language fallback.
- Routing:
  - Pages live under `app/[lang]/...` (home, posts, category, tag, search, about, privacy, disclosure, contact, courses, categories).
  - Root `app/page.tsx` redirects to `/en`.
- Language switcher (`components/LanguageSwitcher.tsx`):
  - Client-side switch updates cookie `locale` (1 year) and keeps clean URLs on mapped domains.
  - Uses per-locale base domains; strips any `/en|/pt|/es|/it` prefix when present.
- Data:
  - Content stored per-locale under `content/posts/{locale}/`.
  - `lib/posts.ts` loads MDX per locale; posts carry `locale`, `translationKey`, `author`, and other frontmatter.
  - Helpers: locale-scoped `getAllPosts(locale?)`, `getAllCategories(locale?)`, `getAllTags(locale?)`, and `getTranslationsFor(translationKey)`.
- SEO:
  - HTML `lang` uses BCP47 (`en`, `pt-BR`, `es-ES`, `it-IT`) via `lib/i18n.ts`.
  - Per-page metadata uses domain-aware canonical + hreflang alternates (only existing translations).
  - JSON-LD uses locale-aware `inLanguage`.
  - `/sitemap.xml` is per-domain; `/sitemap-index.xml` aggregates all locales.
  - `/robots.txt` blocks admin/API and preview indexing.
- Theme/layout:
  - Header/Footer use current locale for navigation links and include theme toggle + language switcher.
